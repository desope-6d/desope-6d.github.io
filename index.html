<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeSOPE: Exploring 6D Object Pose Estimation with Deformation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2d4b8c;
            --accent-color: #4a6fa5;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --text-color: #333;
            --light-gray: #e9ecef;
            --border-radius: 8px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: white;
            color: black;
            padding: 40px 0;
            text-align: center;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .authors {
            font-size: 1.2rem;
            margin-bottom: 15px;
            line-height: 1.8;
            color:black;
        }

        .author-link {
            color: blue;
            text-decoration: none;
            transition: var(--transition);
        }

        .author-link:hover {
            text-decoration: underline;
            color: blue;
        }

        .superscript {
            font-size: 0.8em;
            vertical-align: super;
            margin-left: 2px;
        }

        .affiliations {
            font-size: 1rem;
            margin-bottom: 30px;
            color: black;
        }

        .links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .link-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: var(--secondary-color);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
        }

        .link-btn:hover {
            background-color: var(--accent-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        .link-btn i {
            font-size: 1.2rem;
        }

        .paper-link {
            background-color: black;
        }

        .code-link {
            background-color: black;
        }

        .data-link {
            background-color: black;
        }

        section {
            background-color: white;
            /* border-radius: var(--border-radius); */
            box-shadow: var(--shadow);
            padding: 40px;
            margin: 40px 0;
        }

        .section-title {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--accent-color);
        }

        .teaser-image {
            width: 100%;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .teaser-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .abstract {
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: justify;
        }

        .pipeline-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .pipeline-image {
            width: 90%;
            max-width: 900px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .pipeline-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .pipeline-caption {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 10px;
            font-size: 0.95rem;
        }

        .videos-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-top: 20px;
        }

        .video-wrapper {
            background-color: #000;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .video-wrapper video {
            width: 100%;
            height: auto;
            display: block;
        }

        .video-caption {
            padding: 15px;
            background-color: var(--light-gray);
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
        }

        .models-container {
            margin-top: 20px;
        }

        .models-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .model-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .model-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .model-canvas {
            width: 100%;
            height: 200px;
            background-color: #2c3e50;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
        }

        .model-name {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
            text-align: center;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: var(--light-gray);
            padding: 25px;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .controls.hidden {
            display: none;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .control-label {
            min-width: 120px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .slider-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border-radius: 3px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary-color);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: var(--primary-color);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 20px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .toggle-controls-btn {
            margin-bottom: 15px;
            align-self: flex-start;
        }

        .stats-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .stats-image {
            width: 100%;
            max-width: 900px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .stats-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .citation {
            background-color: var(--light-gray);
            padding: 25px;
            border-radius: var(--border-radius);
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.6;
            white-space: pre-wrap;
            margin-top: 20px;
            border-left: 4px solid var(--accent-color);
        }

        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 30px 0;
            margin-top: 40px;
            font-size: 0.9rem;
        }

        /* 新添加的样式 */
        .model-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .selector-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.2rem;
        }

        .selector-btn:hover {
            background-color: var(--accent-color);
            transform: scale(1.1);
        }

        .selector-number {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            min-width: 30px;
            text-align: center;
        }

        @media (max-width: 992px) {
            .models-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .videos-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .links {
                gap: 15px;
            }
            
            .link-btn {
                padding: 10px 18px;
                font-size: 0.9rem;
            }
            
            section {
                padding: 30px 20px;
            }
            
            .models-grid {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Exploring 6D Object Pose Estimation with Deformation</h1>
            
            <div class="authors">
                <a href="#" class="author-link">Zhiqiang Liu<span class="superscript">1</span></a>, 
                <a href="#" class="author-link">Rui Song<span class="superscript">1</span></a>, 
                <a href="#" class="author-link">Chuanqian Duanmu<span class="superscript">1</span></a>, 
                <a href="#" class="author-link">Jiaojiao Li<span class="superscript">1</span></a>, 
                <a href="#" class="author-link">David Ferst<span class="superscript">2</span></a>, 
                <a href="#" class="author-link">Yinlin Hu<span class="superscript">2</span></a>
            </div>
            
            <div class="affiliations">
                <span class="superscript">1</span>State Key Laboratory of ISN, Xidian University
                <span class="superscript">2</span> MagicLeap
            </div>
            
            <div class="links">
                <a href="#" class="link-btn paper-link">
                    <i class="fas fa-file-pdf"></i> arXiv
                </a>
                <a href="#" class="link-btn code-link">
                    <i class="fab fa-github"></i> Code
                </a>
                <a href="#" class="link-btn data-link">
                    <i class="fas fa-database"></i> Data
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Teaser Image Section -->
        <section id="teaser">
            <div class="teaser-image">
                <img src="static/imgs/teaser.jpg" alt="Teaser image showing different object poses">
            </div>
        </section>

        <!-- Abstract Section -->
        <section id="abstract">
            <h2 class="section-title">
                <i class="fas fa-file-alt"></i> Abstract
            </h2>
            <div class="abstract">
                <p>We present <strong>DeSOPE</strong>, a large-scale dataset designed for Deformed Six-Dof Object Pose Estimation. Most existing 6D object pose approaches assume rigid or articulated objects, leaving deformed daily objects largely unexplored. This gap limits the realism and robustness of current pose estimation methods, which often fail when objects deviate from their canonical shapes due to wear, collision, or deformation.To address this issue, we present DeSOPE, a large-scale real-world dataset specifically designed for deformed object pose estimation. DeSOPE contains two major components: (1) a pose scanning pipeline that uses a non-rigid alignment framework and (2) a real-scene RGB-D dataset comprising <strong>133K</strong> frames and <strong>665K</strong> pose annotations across <strong>104</strong> deformed instances, recorded in both static and dynamic scenarios.The varying degrees of deformation introduce substantial geometric and textural changes, presenting new challenges for existing methods. We present a novel pose estimation pipeline that improves upon the existing methods by reducing the degradation as deformation increases, highlighting the limitations of current pose estimators. As the first large-scale dataset designed for systematic study of deformed object pose estimation, DeSOPE lays the groundwork for developing 6D pose estimators capable of handling real-world deformation and variability.</p>
            </div>
        </section>

        <!-- Pipeline Section -->
        <section id="pipeline">
            <h2 class="section-title">
                <i class="fas fa-project-diagram"></i> Pipeline
            </h2>
            <div class="pipeline-container">
                <div class="pipeline-image">
                    <img src="static/imgs/pipeline.jpg" alt="Pipeline visualization">
                </div>
                <p class="pipeline-caption">
                    Overview of our dataset generation pipeline. It illustrates the complete pipeline for visual perception and pose annotation of deformable objects, encompassing four key stages: (1) Object Scanning, (2) Models Alignment, (3) Video Capture, and (4) Pose Annotation.
                </p>
            </div>
        </section>

        <!-- Scanned 3D Models Section -->
        <section id="models">
            <h2 class="section-title">
                <i class="fas fa-cube"></i> Scanned 3D Assets
            </h2>
            
            <div class="models-container">
                <div class="models-grid" id="models-grid">
                    <!-- 3D models will be loaded here by JavaScript -->
                </div>
                
                <button class="control-btn toggle-controls-btn" id="toggle-controls-btn">
                    <i class="fas fa-cog"></i> Show Controls
                </button>
                
                <div class="controls hidden" id="controls-panel">
                    <h3 style="color: var(--primary-color); margin-bottom: 15px;">3D Model Controls</h3>
                    
                    <div class="control-group">
                        <div class="control-label">Model Scale:</div>
                        <div class="slider-container">
                            <input type="range" min="10" max="100" value="50" class="slider" id="scale-slider">
                            <span class="slider-value" id="scale-value">50%</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">Actions:</div>
                        <div class="button-group">
                            <button class="control-btn" id="auto-rotate-btn">
                                <i class="fas fa-sync"></i> Toggle Auto-Rotate
                            </button>
                            <button class="control-btn" id="toggle-axes-btn">
                                <i class="fas fa-crosshairs"></i> Toggle Axes
                            </button>
                            <button class="control-btn" id="toggle-grid-btn">
                                <i class="fas fa-th-large"></i> Toggle Grid
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 新添加的数字选择栏 -->
            <div class="model-selector">
                <button class="selector-btn" id="prev-btn">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="selector-number" id="current-group">1</div>
                <button class="selector-btn" id="next-btn">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>

        <!-- Results on Registration Section -->
        <section id="registration-results">
            <h2 class="section-title">
                <i class="fas fa-vector-square"></i> Results on Registration between canonical mesh and deformed mesh
            </h2>
            <div class="stats-container">
                <div class="stats-image">
                    <img src="static/imgs/registration.jpg" alt="Dataset statistics visualization">
                </div>
            </div>
        </section>

        <!-- Demo Videos Section -->
        <section id="demos">
            <h2 class="section-title">
                <i class="fas fa-video"></i> Demo Videos
            </h2>
            <div class="videos-container">
                <div class="video-wrapper">
                    <video controls autoplay muted>
                        <source src="static/videos/fdpose/scene_1_static_seq_1.mp4" type="video/mp4">
                    </video>
                    <div class="video-caption">Initial Pose (FoundationPose)</div>
                </div>
                
                <div class="video-wrapper">
                    <video controls autoplay muted>
                        <source src="static/videos/ours/scene_1_static_seq_1.mp4" type="video/mp4">
                    </video>
                    <div class="video-caption">Updated Pose (Ours)</div>
                </div>
            </div>
        </section>

        <!-- Datasets Statistics Section -->
        <section id="statistics">
            <h2 class="section-title">
                <i class="fas fa-chart-bar"></i> Datasets Statistics
            </h2>
            <div class="stats-container">
                <div class="stats-image">
                    <img src="static/imgs/statistic.jpg" alt="Dataset statistics visualization">
                </div>
            </div>
        </section>

        <!-- Performance of SOTA Algorithms Section -->
        <section id="performance-results">
            <h2 class="section-title">
                <i class="fas fa-tachometer-alt"></i> Performance of SOTA Algorithms on DeSOPE
            </h2>
            <div class="stats-container">
                <div class="stats-image">
                    <img src="static/imgs/sota_performance.jpg" alt="Dataset statistics visualization">
                </div>
            </div>
        </section>

        <!-- Citation Section -->
        <section id="citation">
            <h2 class="section-title">
                <i class="fas fa-quote-right"></i> Citation
            </h2>
            <p style="margin-bottom: 15px; font-size: 1.1rem;">
                If you find this work useful in your research, please consider citing:
            </p>
            <div class="citation" style="text-align: justify;">
                <pre><code>@article{liu2026desope,
            title={Exploring 6D Object Pose Estimation with Deformation},
            author={Liu, Zhiqiang and Song, Rui and Duanmu, Chuanqian and Li, Jiaojiao and Ferst, David and Hu, Yinlin},
            journal={arXiv preprint arXiv:2405.XXXXX},
            year={2026},
            doi={10.48550/arXiv.2405.XXXXX}
            }</code></pre>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>© 2026 DeSOPE Project. All Rights Reserved.</p>
            <p>State Key Laboratory of ISN, Xidian University & MagicLeap Research</p>
            <p style="margin-top: 10px; opacity: 0.8;">This webpage is a demonstration of the DeSOPE project interface.</p>
        </div>
    </footer>

    <script>
        // 3D Model Configuration - 扩展为多个组
        const modelGroups = [
            // 第1组模型
            [
                { id: 'model1', name: 'Canonical', file: 'static/models/1.glb' },
                { id: 'model2', name: 'Deformation 1', file: 'static/models/2.glb' },
                { id: 'model3', name: 'Deformation 2', file: 'static/models/3.glb' },
                { id: 'model4', name: 'Deformation 3', file: 'static/models/4.glb' }
            ],
            // 第2组模型
            [
                { id: 'model1', name: 'Canonical', file: 'static/models/5.glb' },
                { id: 'model2', name: 'Deformation 1', file: 'static/models/6.glb' },
                { id: 'model3', name: 'Deformation 2', file: 'static/models/7.glb' },
                { id: 'model4', name: 'Deformation 3', file: 'static/models/8.glb' }
            ],
            // 第3组模型
            [
                { id: 'model1', name: 'Canonical', file: 'static/models/9.glb' },
                { id: 'model2', name: 'Deformation 1', file: 'static/models/10.glb' },
                { id: 'model3', name: 'Deformation 2', file: 'static/models/11.glb' },
                { id: 'model4', name: 'Deformation 3', file: 'static/models/12.glb' }
            ],
            // 第4组模型
            [
                { id: 'model1', name: 'Canonical', file: 'static/models/13.glb' },
                { id: 'model2', name: 'Deformation 1', file: 'static/models/14.glb' },
                { id: 'model3', name: 'Deformation 2', file: 'static/models/15.glb' },
                { id: 'model4', name: 'Deformation 3', file: 'static/models/16.glb' }
            ],
            // 第5组模型
            [
                { id: 'model1', name: 'Canonical', file: 'static/models/17.glb' },
                { id: 'model2', name: 'Deformation 1', file: 'static/models/18.glb' },
                { id: 'model3', name: 'Deformation 2', file: 'static/models/19.glb' },
                { id: 'model4', name: 'Deformation 3', file: 'static/models/20.glb' }
            ]
        ];
        
        // 全局变量
        const scenes = {};
        const renderers = {};
        const cameras = {};
        const controls = {};
        const models = {};
        const materials = {}; // 存储材质信息
        const axesHelpers = {}; // 存储坐标轴辅助对象
        const gridHelpers = {}; // 存储网格辅助对象
        let autoRotate = true;
        let showAxes = true;
        let showGrid = false; // 修改：初始隐藏网格
        let currentGroupIndex = 0;
        const loader = new THREE.GLTFLoader();
        
        // 初始化所有3D模型
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化模型容器
            initializeModelContainers();
            
            // 加载第一组模型
            loadModelGroup(currentGroupIndex);
            
            // 设置控制面板
            setupControls();
            
            // 开始动画循环
            animate();
        });
        
        // 初始化模型容器
        function initializeModelContainers() {
            const modelsGrid = document.getElementById('models-grid');
            modelsGrid.innerHTML = '';
            
            // 创建4个模型容器
            for (let i = 1; i <= 4; i++) {
                const container = document.createElement('div');
                container.className = 'model-item';
                container.innerHTML = `
                    <div class="model-canvas" id="model${i}"></div>
                    <div class="model-name" id="model${i}-name">Loading...</div>
                `;
                modelsGrid.appendChild(container);
            }
        }
        
        // 加载指定组的模型
        function loadModelGroup(groupIndex) {
            // 更新当前组索引显示
            document.getElementById('current-group').textContent = groupIndex + 1;
            
            // 清除现有模型
            Object.keys(models).forEach(key => {
                if (scenes[key]) {
                    // 清除场景中的模型
                    scenes[key].children.forEach(child => {
                        if (child.isMesh || child.isGroup || child.isAxesHelper || child.isGridHelper) {
                            scenes[key].remove(child);
                        }
                    });
                }
            });
            
            // 重置模型引用
            Object.keys(models).forEach(key => {
                delete models[key];
            });
            
            // 加载新组模型
            const currentGroup = modelGroups[groupIndex];
            currentGroup.forEach((config, index) => {
                const containerId = config.id;
                const modelFile = config.file;
                
                // 更新模型名称
                document.getElementById(`${containerId}-name`).textContent = config.name;
                
                // 初始化3D场景（如果尚未初始化）
                if (!scenes[containerId]) {
                    init3DScene(containerId);
                }
                
                // 加载模型
                loadModel(containerId, modelFile);
            });
        }
        
        // 初始化3D场景
        function init3DScene(containerId) {
            const container = document.getElementById(containerId);
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            // 创建场景
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xffffff);
            
            // 创建相机
            const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            camera.position.set(0, 0, 5);
            
            // 创建渲染器
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.innerHTML = ''; // 清除现有内容
            container.appendChild(renderer.domElement);
            
            // 添加轨道控制
            const orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
            orbitControls.enableDamping = true;
            orbitControls.dampingFactor = 0.05;
            
            // 增强光照 - 添加太阳光等自然光照
            const ambientLight = new THREE.AmbientLight(0xffffff, 3.0); // 增加环境光强度
            scene.add(ambientLight);
            
            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 3.5); // 主光源
            directionalLight1.position.set(5, 10, 7);
            scene.add(directionalLight1);
            
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8); // 补充光源
            directionalLight2.position.set(-5, 5, -5);
            scene.add(directionalLight2);
            
            const directionalLight3 = new THREE.DirectionalLight(0xffffff, 0.5); // 背光
            directionalLight3.position.set(0, -5, -5);
            scene.add(directionalLight3);
            
            // 添加坐标轴辅助
            const axesHelper = new THREE.AxesHelper(2);
            scene.add(axesHelper);
            axesHelpers[containerId] = axesHelper;
            
            // 添加网格辅助
            const gridHelper = new THREE.GridHelper(10, 10);
            gridHelper.visible = showGrid; // 修改：初始隐藏网格
            scene.add(gridHelper);
            gridHelpers[containerId] = gridHelper;
            
            // 存储引用
            scenes[containerId] = scene;
            renderers[containerId] = renderer;
            cameras[containerId] = camera;
            controls[containerId] = orbitControls;
        }
        
        // 加载模型
        function loadModel(containerId, modelFile) {
            loader.load(
                modelFile,
                function(gltf) {
                    const model = gltf.scene;
                    
                    // 缩放和定位模型
                    model.scale.set(1, 1, 1);
                    model.position.set(0, 0, 0);
                    
                    // 添加到场景
                    scenes[containerId].add(model);
                    
                    // 存储模型引用
                    models[containerId] = model;
                    
                    // 存储材质信息
                    materials[containerId] = [];
                    model.traverse(function(child) {
                        if (child.isMesh) {
                            // 保存原始材质属性
                            const materialInfo = {
                                material: child.material,
                                originalEmissive: child.material.emissive ? child.material.emissive.clone() : new THREE.Color(0x000000),
                                originalEmissiveIntensity: child.material.emissiveIntensity || 0
                            };
                            materials[containerId].push(materialInfo);
                        }
                    });
                    
                    // 调整相机以适合模型
                    const box = new THREE.Box3().setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    const size = box.getSize(new THREE.Vector3());
                    
                    // 确保模型可见
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const fov = cameras[containerId].fov * (Math.PI / 180);
                    let cameraZ = Math.abs(maxDim / Math.sin(fov / 2));
                    
                    cameras[containerId].position.z = cameraZ * 1.5;
                    controls[containerId].update();
                },
                function(xhr) {
                    // 进度回调
                    console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                },
                function(error) {
                    console.error('Error loading model:', error);
                    // 创建占位符
                    const geometry = new THREE.BoxGeometry(1, 1, 1);
                    const material = new THREE.MeshStandardMaterial({ 
                        color: 0x4a6fa5,
                        roughness: 0.4,
                        metalness: 0.1
                    });
                    const model = new THREE.Mesh(geometry, material);
                    scenes[containerId].add(model);
                    models[containerId] = model;
                    
                    // 存储材质信息
                    materials[containerId] = [{
                        material: material,
                        originalEmissive: new THREE.Color(0x000000),
                        originalEmissiveIntensity: 0
                    }];
                }
            );
        }
        
        // 设置控制面板
        function setupControls() {
            // 控制面板显示/隐藏按钮
            const toggleControlsBtn = document.getElementById('toggle-controls-btn');
            const controlsPanel = document.getElementById('controls-panel');
            
            // 初始化按钮文本
            toggleControlsBtn.innerHTML = controlsPanel.classList.contains('hidden') ? 
                '<i class="fas fa-cog"></i> Show Controls' : 
                '<i class="fas fa-cog"></i> Hide Controls';
            
            toggleControlsBtn.addEventListener('click', function() {
                controlsPanel.classList.toggle('hidden');
                this.innerHTML = controlsPanel.classList.contains('hidden') ? 
                    '<i class="fas fa-cog"></i> Show Controls' : 
                    '<i class="fas fa-cog"></i> Hide Controls';
            });
            
            // 缩放控制条
            const scaleSlider = document.getElementById('scale-slider');
            const scaleValue = document.getElementById('scale-value');
            
            scaleSlider.addEventListener('input', function() {
                const value = this.value;
                scaleValue.textContent = value + '%';
                
                // 更新所有模型的缩放
                Object.values(models).forEach(model => {
                    const scale = value / 50; // 50% = 缩放1.0
                    model.scale.set(scale, scale, scale);
                });
            });
            
            // 自动旋转切换按钮
            document.getElementById('auto-rotate-btn').addEventListener('click', function() {
                autoRotate = !autoRotate;
                this.innerHTML = autoRotate ? 
                    '<i class="fas fa-sync"></i> Disable Auto-Rotate' : 
                    '<i class="fas fa-sync"></i> Enable Auto-Rotate';
            });
            
            // 坐标轴显示切换按钮
            const toggleAxesBtn = document.getElementById('toggle-axes-btn');
            // 设置初始按钮文本
            toggleAxesBtn.innerHTML = showAxes ? 
                '<i class="fas fa-crosshairs"></i> Hide Axes' : 
                '<i class="fas fa-crosshairs"></i> Show Axes';
                
            toggleAxesBtn.addEventListener('click', function() {
                showAxes = !showAxes;
                
                // 更新所有坐标轴辅助
                Object.values(axesHelpers).forEach(axesHelper => {
                    axesHelper.visible = showAxes;
                });
                
                this.innerHTML = showAxes ? 
                    '<i class="fas fa-crosshairs"></i> Hide Axes' : 
                    '<i class="fas fa-crosshairs"></i> Show Axes';
            });
            
            // 网格显示切换按钮
            const toggleGridBtn = document.getElementById('toggle-grid-btn');
            // 设置初始按钮文本
            toggleGridBtn.innerHTML = showGrid ? 
                '<i class="fas fa-th-large"></i> Hide Grid' : 
                '<i class="fas fa-th-large"></i> Show Grid';
                
            toggleGridBtn.addEventListener('click', function() {
                showGrid = !showGrid;
                
                // 更新所有网格辅助
                Object.values(gridHelpers).forEach(gridHelper => {
                    gridHelper.visible = showGrid;
                });
                
                this.innerHTML = showGrid ? 
                    '<i class="fas fa-th-large"></i> Hide Grid' : 
                    '<i class="fas fa-th-large"></i> Show Grid';
            });
            
            // 组选择按钮
            document.getElementById('prev-btn').addEventListener('click', function() {
                currentGroupIndex = (currentGroupIndex - 1 + modelGroups.length) % modelGroups.length;
                loadModelGroup(currentGroupIndex);
            });
            
            document.getElementById('next-btn').addEventListener('click', function() {
                currentGroupIndex = (currentGroupIndex + 1) % modelGroups.length;
                loadModelGroup(currentGroupIndex);
            });
            
            // 处理窗口大小调整
            window.addEventListener('resize', function() {
                for (let i = 1; i <= 4; i++) {
                    const containerId = `model${i}`;
                    const container = document.getElementById(containerId);
                    if (!container) continue;
                    
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    
                    const camera = cameras[containerId];
                    const renderer = renderers[containerId];
                    
                    if (camera && renderer) {
                        camera.aspect = width / height;
                        camera.updateProjectionMatrix();
                        renderer.setSize(width, height);
                    }
                }
            });
        }
        
        // 动画循环
        function animate() {
            requestAnimationFrame(animate);
            
            // 更新每个模型
            for (let i = 1; i <= 4; i++) {
                const containerId = `model${i}`;
                const model = models[containerId];
                const control = controls[containerId];
                const renderer = renderers[containerId];
                const camera = cameras[containerId];
                const scene = scenes[containerId];
                
                if (model && autoRotate) {
                    model.rotation.y += 0.005; // 固定旋转速度
                }
                
                if (control) {
                    control.update();
                }
                
                if (renderer && scene && camera) {
                    renderer.render(scene, camera);
                }
            }
        }
    </script>
</body>
</html>  
